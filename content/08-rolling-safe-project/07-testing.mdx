---
title: Testing, Testing, Testing
description: 
slug: /cso-platform-tests
---

# SmartPy Testing in the IDE

We test our platform on diffrent levels with diffrent tools. 

We can use the SmartPy IDE for testing. Let us define our scenario:

```python
@sp.add_test(name= "Initialization")
def initialization():
    
    # dummy addresses
    organization = sp.address("tz1hRTppkUow3wQNcj9nZ9s5snwc6sGC8QHh")
    buyer1 = sp.address("tz1xbuyer1")
    buyer2 = sp.address("tz1xbuyer2")

    contract= PEQ(
        organization = organization, 
        b = 2000, 
        s = 1000, 
        initial_price = sp.tez(1), 
        MFG = sp.tez(1000), 
        preminted = 0,
        MPT = 1, # minimal period of time in years
        I = 90,
        D = 80, 
        company_valuation = 1000000,
        total_allocation = 4000,
        stake_allocation = 500,
        termination_events = ["Sale", "Bankruptcy"],
        govRights = "None",
        company_name = "TZMINT Demo"
        )

    scenario = sp.test_scenario()
    scenario += contract
```

The test starts by initialisation of the `contract`. Most of those initial parameters are arbitrary. Now we can do some test for `buy`: 

```python
    # buy some tokens till reaching MFG check the price is fix
    scenario += contract.buy().run(sender = buyer1, amount = sp.mutez(500001000))
    
    # try to sell some before phase 1
    scenario += contract.sell(amount=1).run(sender = buyer1, valid=False)
```

Note that we expect the `sell` call to fail before MFG phase is over. We can do a few more `buy` calls:

```python
    scenario += contract.buy().run(sender = buyer2, amount = sp.mutez(200003000))
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(300))
    scenario.verify(contract.data.price == sp.tez(1))
```

In addition we check that the price does not change in the MFG phase. This will be different after MFG is reached:

```python
    # now MFG is reached, buy more and see price increasing
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(50))
    scenario += contract.buy().run(sender = buyer2, amount = sp.tez(400))
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(100))
    scenario.verify(contract.data.price > sp.tez(1))
```

We expect the price to increase after some `buy` calls. We can also sell some tokens:

```python
    scenario += contract.buy().run(sender = buyer1, amount = sp.mutez(51245389))
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(100))

    # now sell some tokens
    scenario += contract.sell(amount=100).run(sender = buyer1)

```

As you know, SmartPy will show detailed information of the transactions. So we can make a few more calls to see the price changing over time:

```python
    # and see how the price changes if you buy again
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(150))
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(150))
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(150))
    scenario += contract.buy().run(sender = buyer1, amount = sp.tez(50))
```

You can also check the price of a token with the output of:

```python
    # Check price for selling 1 token
    scenario += contract.sell(amount=1).run(sender = buyer1)
```

in the right panel of the IDE.

Least thing to test is the the closing and the permissions for calling it:

```python
    # Check closing before MPT
    scenario += contract.close().run(sender = organization, valid=False, amount = sp.tez(2400), now= sp.timestamp_from_utc_now().add_days(360))
    # Check closing with wrong account
    scenario += contract.close().run(sender = buyer1, valid=False, now= sp.timestamp_from_utc_now().add_days(365))
    # Check closing with too less tez
    scenario += contract.close().run(sender = organization, valid=False, amount = sp.tez(300), now= sp.timestamp_from_utc_now().add_days(365))
    # Check closing with correct amount of tez
    scenario += contract.close().run(sender = organization, amount = sp.tez(2400), now= sp.timestamp_from_utc_now().add_days(365))
```