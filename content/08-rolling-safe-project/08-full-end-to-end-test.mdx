---
title: More Testing - A Full End-to-End Test Setup
description: 
slug: /rolling-safe-tezos-full-end-to-end-test
---

import HighlightBox from "../../src/components/HighlightBox"

import {
  ExpansionPanel,
  ExpansionPanelList,
  ExpansionPanelListItem
} from 'gatsby-theme-apollo-docs';

<!-- Need intro sentence and description-->

## Test network

We use [Docker Compose](https://docs.docker.com/compose/) to create a network composed by:

* Three TzKT containers,
* A container with the Flextesa sandbox, and
* A container for the TZMINT web application.

![Stack in the docker dashboard!](./images/stack-docker-dashboard.png)

## Flextesa sandbox

We use the [Flextesa image](https://hub.docker.com/r/tqtezos/flextesa/tags?page=1&ordering=last_updated) to create a sandbox environment. After the sandbox starts and the node responds, the bootstrap process starts:

* The Tezos client is configured;
* Alice and Bob's secret keys are imported;
* The contract is deployed and the address becomes available;
* Another test account is created and funded, used to sign `buy` and `sell` transactions.

## TzKT

A TzKT indexer (tzkt-sync) is configured to extract data from the node in the sandbox. In addition, a TzKT API container exposes data to the TZMINT web application.

## Database

The database container uses PostgreSQL to store the fetched data. It contains a database for the web application and a database for the TzKT indexer.

## Browser interaction

If you visit and test the TZMINT web application, you can see that a wallet pop-up appears asking for confirmation each time you want to sign and send a transaction. For automation purposes, we use [Cypress.io](https://github.com/cypress-io/cypress) to visit and test the site and [Puppeteer](https://github.com/puppeteer/puppeteer) interaction with the wallet extensions.

Puppeteer switches between wallet pop-up and Cypress Windows to sequentially interact with the site and the wallet. This allows us to perform actions like submitting a transaction or confirming an address.

At the beginning of a test, Cypress opens a Google Chrome instance loading a previously downloaded version of the wallet extension. When the test requires to interact with the wallet, it will import the account via a mnemonic and configure the settings for the custom-created network.

The TZMINT web application container (app) pulls the Cypress browser image and loads the web application volume.

Once the sandbox is bootstrapped it does a fresh install of the dependencies. Then it prepares the environment used during the tests by:

* Reading the contract address from a helper file written by the sandbox container after the contract deployment,
* Defining the test account mnemonic and address, and
* Configuring the API endpoint and the RPC node endpoint.

Then the unit and the end-to-end tests are executed.
